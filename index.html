<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Fingerprint 检测结果</title>
  <script src="https://fpcdn.io/v3/YOUR_PUBLIC_API_KEY"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    .field { margin-bottom: 12px; }
    .label { font-weight: bold; color: #444; }
    .value { color: #000; }
    .highlight { background: #ffecec; border-left: 4px solid #e74c3c; padding: 5px; }
    .btn-group { margin-top: 20px; }
    button, a.button-link {
      margin-right: 10px; padding: 10px 18px; font-size: 14px; border: none;
      border-radius: 6px; cursor: pointer; text-decoration: none;
    }
    button { background-color: #3498db; color: white; }
    a.button-link { background-color: #2ecc71; color: white; }
  </style>
</head>
<body>
  <div class="card">
    <h2>设备识别信息</h2>
    <div id="result">正在检测...</div>
    <div class="btn-group">
      <a href="https://iphey.com/#hardware" class="button-link">辅助检测</a>
      <button onclick="copyRawData()">复制代码</button>
    </div>
  </div>

  <script>
    let rawData = null;

    function formatData(data) {
      const resultEl = document.getElementById('result');
      resultEl.innerHTML = '';

      const output = [];

      function renderField(label, value, highlight = false) {
        const div = document.createElement('div');
        div.className = 'field' + (highlight ? ' highlight' : '');
        div.innerHTML = `<div class="label">${label}：</div><div class="value">${value}</div>`;
        output.push(div);
      }

      // 中文化主要字段
      renderField('访问者 ID', data.visitorId);
      renderField('浏览器', `${data.browserDetails.browserName} ${data.browserDetails.browserFullVersion}`);
      renderField('操作系统', `${data.browserDetails.os} ${data.browserDetails.osVersion}`);
      renderField('IP 地址', data.ip);
      renderField('所在城市', data.ipLocation?.city?.name || '未知');
      renderField('国家', data.ipLocation?.country?.name || '未知');
      renderField('时区', data.ipLocation?.timezone);
      renderField('是否隐身模式', data.incognito ? '是' : '否');
      renderField('是否使用 VPN', data.vpn?.result ? '是' : '否', data.vpn?.result);
      renderField('是否代理 Proxy', data.proxy?.result ? '是' : '否', data.proxy?.result);
      renderField('是否虚拟机/模拟器', data.virtualMachine?.result || data.emulator?.result ? '是' : '否', data.virtualMachine?.result || data.emulator?.result);
      renderField('可疑评分', data.suspectScore?.result || 0, (data.suspectScore?.result || 0) > 5);

      resultEl.innerHTML = '';
      output.forEach(el => resultEl.appendChild(el));
    }

    function copyRawData() {
      if (rawData) {
        navigator.clipboard.writeText(JSON.stringify(rawData, null, 2)).then(() => {
          alert('检测结果已复制到剪贴板');
        });
      }
    }

    async function runFingerprint() {
      try {
        const fp = await Fingerprint.load();
        const result = await fp.get();

        // 调用 Fingerprint 服务后台接口拉取完整信息
        const response = await fetch(`https://api.fpjs.io/events/${result.visitorId}`, {
          headers: { 'Authorization': 'Bearer YOUR_SECRET_API_KEY' } // 注意：需使用后端代理或更安全方式
        });

        const fullData = await response.json();

        rawData = fullData.products?.identification?.data || {};
        rawData.vpn = fullData.products?.vpn?.data;
        rawData.proxy = fullData.products?.proxy?.data;
        rawData.virtualMachine = fullData.products?.virtualMachine?.data;
        rawData.emulator = fullData.products?.emulator?.data;
        rawData.incognito = fullData.products?.incognito?.data?.result;
        rawData.ipLocation = rawData.ipLocation || fullData.products?.ipInfo?.data?.v4?.geolocation;
        rawData.suspectScore = fullData.products?.suspectScore?.data;

        formatData(rawData);
      } catch (err) {
        document.getElementById('result').innerHTML = `<span style="color: red;">检测失败，请稍后重试。错误：${err.message}</span>`;
        console.error(err);
      }
    }

    runFingerprint();
  </script>
</body>
</html>
