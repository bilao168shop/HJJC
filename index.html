<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>设备指纹检测</title>
  <script src="https://fpjscdn.net/v3/k88Qqpi0mqB3GklSIlqg?region=us"></script>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .highlight {
      color: red;
      font-weight: bold;
    }
    .entry {
      margin: 5px 0;
      padding: 5px 10px;
      background: #fff;
      border-left: 4px solid #ccc;
    }
    .entry.highlight {
      border-left-color: red;
      background-color: #ffeaea;
    }
    button {
      margin: 10px 10px 10px 0;
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      background-color: #2d8cf0;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1a73e8;
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
      background: #fff;
      padding: 10px;
      border-radius: 4px;
      max-height: 400px;
      overflow: auto;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>设备指纹检测结果</h1>
  <div id="results">正在检测中...</div>
  <button onclick="window.open('https://iphey.com/#hardware', '_blank')">辅助检测</button>
  <button onclick="copyResults()">复制代码</button>

  <script>
    async function runFingerprint() {
      try {
        const fp = await Fingerprint.load();
        const result = await fp.get();
        const data = result.products;

        let fullData = JSON.stringify(data, null, 2); // 备用复制
        let container = document.getElementById("results");
        container.innerHTML = "";

        function renderEntry(label, value, highlight = false) {
          let div = document.createElement("div");
          div.className = "entry" + (highlight ? " highlight" : "");
          div.innerHTML = `<strong>${label}：</strong> ${value}`;
          container.appendChild(div);
        }

        const explain = {
          visitorId: "访客唯一识别码",
          ip: "IP地址",
          os: "操作系统",
          osVersion: "系统版本",
          browserName: "浏览器",
          browserFullVersion: "浏览器版本",
          device: "设备类型",
          timezone: "时区",
          confidence: "识别置信度",
          proxy: "代理检测",
          vpn: "VPN检测",
          tor: "Tor检测",
          tampering: "浏览器伪装",
          incognito: "是否无痕模式",
          virtualMachine: "是否虚拟机",
          emulator: "是否模拟器",
          rootApps: "是否Root环境",
          suspectScore: "可疑评分",
          highActivity: "高频行为",
          developerTools: "开发者工具开启",
          remoteControl: "远程控制检测",
          locationSpoofing: "位置伪装"
        };

        // 核心字段显示
        const id = data.identification?.data || {};
        renderEntry(explain.visitorId, id.visitorId || "未知");
        renderEntry(explain.ip, id.ip || "未知");
        renderEntry(explain.browserName, id.browserDetails?.browserName);
        renderEntry(explain.browserFullVersion, id.browserDetails?.browserFullVersion);
        renderEntry(explain.os, id.browserDetails?.os);
        renderEntry(explain.osVersion, id.browserDetails?.osVersion);
        renderEntry(explain.device, id.browserDetails?.device);
        renderEntry(explain.timezone, id.ipLocation?.timezone || "未知");

        // 风控字段
        const riskFields = [
          {key: "proxy", value: data.proxy?.data?.result, name: explain.proxy},
          {key: "vpn", value: data.vpn?.data?.result, name: explain.vpn},
          {key: "tor", value: data.tor?.data?.result, name: explain.tor},
          {key: "tampering", value: data.tampering?.data?.result, name: explain.tampering},
          {key: "incognito", value: data.incognito?.data?.result, name: explain.incognito},
          {key: "virtualMachine", value: data.virtualMachine?.data?.result, name: explain.virtualMachine},
          {key: "emulator", value: data.emulator?.data?.result, name: explain.emulator},
          {key: "rootApps", value: data.rootApps?.data?.result, name: explain.rootApps},
          {key: "highActivity", value: data.highActivity?.data?.result, name: explain.highActivity},
          {key: "developerTools", value: data.developerTools?.data?.result, name: explain.developerTools},
          {key: "remoteControl", value: data.remoteControl?.data?.result, name: explain.remoteControl},
          {key: "locationSpoofing", value: data.locationSpoofing?.data?.result, name: explain.locationSpoofing},
        ];

        riskFields.forEach(item => {
          const isRisk = item.value === true;
          renderEntry(item.name, isRisk ? "⚠️ 检测异常" : "正常", isRisk);
        });

        // 显示 suspect 分数
        const suspectScore = data.suspectScore?.data?.result ?? 0;
        renderEntry(explain.suspectScore, suspectScore, suspectScore > 0);

        // 保存完整数据供复制按钮使用
        window._fp_full_result = fullData;

      } catch (err) {
        document.getElementById("results").innerText =
          "检测失败，请稍后重试。\n错误：" + err.message;
        console.error("Fingerprint error:", err);
      }
    }

    function copyResults() {
      navigator.clipboard.writeText(window._fp_full_result || "无数据").then(() => {
        alert("检测结果已复制！");
      });
    }

    runFingerprint();
  </script>
</body>
</html>
